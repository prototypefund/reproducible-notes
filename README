Notes on build reproducibility of Debian packages
=================================================

This repository contains notes concerning the status of build
reproducibility of Debian packages.

There is another repository, ssh://git.debian.org/git/reproducible/misc.git
which contains some scripts to deal with these YAML files here:

FIXME: the description below is for the upcoming multi project notes.git,
       for which the syntax should be defined before we write the parser.

FIXME: To ease the transition from old Debian-only notes.git someone also
       needs to write a converter, which makes all issues generic, except
       some defined ones (blacklisted_on_some_arch… etc), all bugs need to
       be made debian specific and all version numbers probably as well.

Open questions for multi project notes.git:
-------------------------------------------
- to mark a note for a project, we add the project and even name and version
  are optional? (would that be correct yaml?)
  + 'version' can probably be made mandatory?
  + to mark a note for a project, can we do
      socat.debian.version: 1.7.2.4-1
      socat.upstream.version: null
    meaning '1.7.2.4-1 is the newest debian package version known to have the bug'
    and "as of this writing, upstream doesn't have the bug"?
- shall we keep a hard-coded list of projects or how to detect them? (not all
  projects starts capitalized, eg coreboot)
- also see the file ideas_on_sharing_notes_between_distros in this directory…
  (instead of using "distro"-keys as suggested there we use distros.yaml to
  save people lots of "distro"-typing and intending in (packages|issues).yaml)
- instead of socat.debian.bugs: and socat.bugs:, change the latter to
  socat.upstream.bugs:?
- Allow specifying 'bug: http://foo/bar' and *not* have that appended to
  bug-base:, in case some bugs are canonically tracked in an external bug
  tracker (e.g., some at bugs.${project}.org and some at github)

packages.yml
------------

`packages.yml` is a YAML file with notes about source packages.

A full entry looks like the following:

    socat:
     debian:
       version: 1.7.2.4-1
       comments: |
         Patch submitted.
       bugs:
        - 764251
       arch-armhf:
         issues:
           - blacklisted_on_armhf
         comments: |
           this is just an silly architecture specific example comment.
     archlinux:
       version: 1.7.3.2
       issues:
         - ftbfs_due_to_gcc7_transition
       arch-x86:
         comments: |
           another silly comment explaining architectures can be called differently.
     freebsd:
       name: gnu-socat
       version: 1.8
     issues:
       - timestamps_from_cpp_macros
     bugs:
       - https://githost.example.org/issues/4223 
     comments: |
       Upstream said they will fix the issue soon.
 
Every field is optional, although a version number would be useful to do
cleanups.

 - `version`: is the earliest Debian version number of the examined source package, usually the one in unstable.

 - `issues`: is a list of tags as described in the `issues.yml` file.

 - `bugs`: is a list of Debian bug numbers reported about the package.

 - `comments`: is a free-form multi-line field to leave comments.

If an issue for the package has been fixed in sid, it should be removed from `packages.yml`.

issues.yml
----------

`issues.yml` is a YAML file with a description of common issues.

A full entry looks like the following:

    timestamps_from_cpp_macros:
      description: |
        The C pre-processor macros `__DATE__`, `__TIME__`, and `__TIMESTAMP__`
        capture the current time, and thus will obviously make a build
        unreproducible.
      url: https://wiki.debian.org/ReproducibleBuilds/TimestampFromCPPMacros
      Debian:
        bug: 123456
        url: https://example.com

The name of the issue should contain underscores instead of hyphens as
text editor autocompletion works better with the former.

 - `description`:  is a mandatory free-form multi-line description of the issue.

 - `url`: is an optional field pointer to a page (ideally on the Debian wiki)
    describing the issue in more details.

 - `deterministic` (default False): is an optional field indicating whether
    we expect that this issue would always happen on Jenkins; i.e. if
    there is a successful build, then the issue is fixed.


distros.yml
----------

`distros.yml` is a YAML file with a description of tested distributions and other projects.

A full entry looks like the following:

    distro:
      key: debian
      name: Debian
      bug-base: https://bugs.debian.org/
    distro:
      key: coreboot
      name: coreboot
    distro:
      key: freebsd
      name: FreeBSD
      bug-base: https://bugs.freebsd.org/
    distro:
      key: archlinux
      name: ArchLinux

 - `key`:  is a mandatory key consisting of a non-capitalised alpha-numerical
    identifier to be used in packages.yaml and issues.yaml

 - `name`: is an optional string specifying how the key should be displayed in
    human readable output.

 - `bug-base`: is an optional string to be used as the URL base for bugs.

